exports.id=0,exports.modules={"./src/server/server.js":function(e,t,s){"use strict";s.r(t);var a=s("../build/contracts/FlightSuretyApp.json"),o=s("../build/contracts/FlightSuretyData.json"),n=s("./src/server/config.json"),r=s("web3"),i=s.n(r),l=s("express"),c=s.n(l);s("babel-polyfill");const u=s("body-parser");let h=n.localhost,d=new i.a(new i.a.providers.WebsocketProvider(h.url.replace("http","ws")));d.eth.defaultAccount=d.eth.accounts[0];let g=new d.eth.Contract(a.abi,h.appAddress);const f=new d.eth.Contract(o.abi,h.dataAddress),p={oracles:[],flights:[],states:{0:"unknown",10:"on time",20:"late due to airline",30:"late due to weather",40:"late due to technical reason",50:"late due to other reason"},init:async function(e){g.events.OracleRegistered().on("data",e=>{const{event:t,returnValues:{indexes:s}}=e;console.log(`${t}: indexes ${s[0]} ${s[1]} ${s[2]}`)}).on("error",e=>{console.log(e)}),g.events.OracleRequest().on("error",e=>{console.log(e)}).on("data",async e=>{const{event:t,returnValues:{index:s,airline:a,flight:o,timestamp:n}}=e;console.log(`${t}: index ${s}, airline ${a}, flight ${o}, date ${n}`),await this.submitResponses(a,o,n)}),g.events.OracleReport().on("data",e=>{const{event:t,returnValues:{airline:s,flight:a,timestamp:o,status:n}}=e;console.log(`${t}: airline ${s}, flight ${a}, date ${o}, status ${this.states[n]}`)}),g.events.FlightStatusInfo().on("data",e=>{const{event:t,returnValues:{airline:s,flight:a,timestamp:o,status:n}}=e;console.log(`${t}: airline ${s}, flight ${a}, date ${o}, status ${this.states[n]}`)}).on("error",e=>{console.log(e)}),g.events.fetchFlightStatus().on("data",e=>{const{event:t,returnValues:{airline:s,flight:a,timestamp:o,statusCode:n}}=e;console.log(`${t}: airline ${s}, flight ${a}, date ${o}, status ${this.states[n]}`)}),await f.methods.authorizeCaller(g._address),this.oracles=(await d.eth.getAccounts()).slice(10-e);const t=await g.methods.REGISTRATION_FEE().call();this.oracles.forEach(async e=>{try{await g.methods.registerOracle().send({from:e,value:t,gas:4712388,gasPrice:1e11})}catch(e){}})},submitResponses:async function(e,t,s){this.oracles.forEach(async a=>{const o=10*(Math.floor(5*Math.random())+1);(await g.methods.getMyIndexes().call({from:a})).forEach(async n=>{try{await g.methods.submitOracleResponse(n,e,t,s,o).send({from:a})}catch(e){}})})}};p.init(10);const $=c()();$.use(u.json()),$.use((function(e,t,s){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),s()})),$.use(c.a.json()),$.get("/api",(e,t)=>{t.send({message:"An API for use with your Dapp!"})}),$.set("json spaces",2),$.get("/flights",(e,t)=>{t.json(p.flights)}),t.default=$}};